# План выполнения лабораторной работы: Настройка CI/CD

## Этап 1: Подготовка проекта и настройка CI

### Шаг 1.1: Инициализация Git репозитория
```bash
git init
git add .
git commit -m "Initial commit: iOS Calculator project"
```

### Шаг 1.2: Создание репозитория на GitHub
1. Перейдите на [GitHub](https://github.com)
2. Создайте новый репозиторий (например, `ios-calculator`)
3. Не инициализируйте его с README, .gitignore или лицензией
4. Скопируйте URL репозитория

### Шаг 1.3: Подключение локального репозитория к GitHub
```bash
git remote add origin <URL_ВАШЕГО_РЕПОЗИТОРИЯ>
git branch -M main
git push -u origin main
```

### Шаг 1.4: Создание GitHub Actions workflow
1. Перейдите в репозиторий на GitHub
2. Откройте вкладку **Actions**
3. Нажмите **Set up a workflow yourself** или выберите шаблон
4. Файл `.github/workflows/main.yml` уже создан в проекте
5. Сделайте коммит и push:
```bash
git add .github/workflows/main.yml
git commit -m "Add CI workflow"
git push
```

### Шаг 1.5: Проверка работы CI
1. Перейдите во вкладку **Actions** на GitHub
2. Убедитесь, что workflow запустился автоматически
3. Проверьте статус выполнения (должен быть зеленым ✅)
4. Откройте workflow run и проверьте логи каждого шага

### Шаг 1.6: Настройка автоматического запуска при коммитах
Workflow уже настроен на автоматический запуск при:
- Push в любую ветку
- Pull Request в main/development/release
- Создании тегов

## Этап 2: Добавление тестов

### Шаг 2.1: Написание unit-тестов
Тесты уже добавлены в проект:
- `SimpleCalculatorPackage/Tests/SimpleCalculatorFeatureTests/SimpleCalculatorFeatureTests.swift`

### Шаг 2.2: Проверка тестов локально
```bash
# Запуск тестов через Swift Package Manager
cd SimpleCalculatorPackage
swift test

# Или через Xcode
# Product > Test (⌘U)
```

### Шаг 2.3: Проверка тестов через CI
1. Сделайте коммит с тестами
2. Push в репозиторий
3. Проверьте, что CI запустил тесты и они прошли успешно

## Этап 3: Работа с ветками (Git Flow)

### Шаг 3.1: Создание ветки development
```bash
git checkout -b development
git push -u origin development
```

### Шаг 3.2: Разработка новой функции
1. Переключитесь на ветку development:
```bash
git checkout development
```

2. Внесите изменения в код (например, добавьте новую функцию калькулятора)
3. Закоммитьте изменения:
```bash
git add .
git commit -m "Add new feature: [описание функции]"
git push
```

4. Проверьте, что CI запустился для ветки development
5. Убедитесь, что все тесты прошли успешно

### Шаг 3.3: Создание Pull Request
1. Перейдите на GitHub в ваш репозиторий
2. Нажмите **Compare & pull request** (появится после push в development)
3. Заполните описание PR
4. Создайте PR из `development` в `main`

### Шаг 3.4: Автоматическое тестирование PR
- CI автоматически запустит тесты для PR
- Проверьте статус проверок в PR
- Убедитесь, что все проверки прошли (зеленые галочки)

### Шаг 3.5: Слияние PR
1. После успешного прохождения всех тестов
2. Нажмите **Merge pull request**
3. Подтвердите слияние
4. Удалите ветку development (опционально)

### Шаг 3.6: Проверка слияния
1. Переключитесь на main:
```bash
git checkout main
git pull
```

2. Убедитесь, что изменения из development влились в main
3. Проверьте, что CI запустился для main после слияния

## Этап 4: Подготовка релиза

### Шаг 4.1: Создание ветки release
```bash
git checkout -b release/v1.0.0
git push -u origin release/v1.0.0
```

### Шаг 4.2: Подготовка к релизу
1. Обновите версию приложения в:
   - `SimpleCalculator.xcodeproj` (Build Settings > Version)
   - `README.md` (версия в документации)

2. Исправьте баги, если есть
3. Обновите CHANGELOG.md (если создан)

### Шаг 4.3: Коммит изменений в release
```bash
git add .
git commit -m "Prepare release v1.0.0"
git push
```

### Шаг 4.4: Проверка CI для release
1. Убедитесь, что CI запустился для ветки release
2. Проверьте, что все тесты прошли успешно

### Шаг 4.5: Создание тега версии
```bash
git tag -a v1.0.0 -m "Release version 1.0.0"
git push origin v1.0.0
```

Или через GitHub:
1. Перейдите в **Releases** на GitHub
2. Нажмите **Create a new release**
3. Выберите тег `v1.0.0`
4. Заполните описание релиза
5. Опубликуйте release

### Шаг 4.6: Слияние release в main
1. Создайте PR из `release/v1.0.0` в `main`
2. После успешного прохождения тестов, слейте PR
3. Также слейте изменения в `development` (если нужно)

## Этап 5: Документация

### Шаг 5.1: Создание документации
Документация уже создана:
- `README.md` - основная документация проекта
- Комментарии в коде для генерации документации

### Шаг 5.2: Настройка автоматической генерации документации
CI workflow уже настроен на автоматическую генерацию документации:
- При каждом коммите генерируется документация через Swift-DocC
- Документация публикуется в GitHub Pages (опционально)

### Шаг 5.3: Проверка обновления документации
1. Внесите изменения в код с комментариями
2. Сделайте коммит и push
3. Проверьте, что CI сгенерировал документацию
4. Убедитесь, что документация обновилась

## Этап 6: Финальная проверка

### Шаг 6.1: Проверка всех workflow
Убедитесь, что все workflow работают:
- ✅ CI запускается при коммитах
- ✅ Тесты проходят успешно
- ✅ PR проверяются автоматически
- ✅ Release workflow работает
- ✅ Документация генерируется

### Шаг 6.2: Финальный коммит
```bash
git add .
git commit -m "Final: Complete CI/CD setup"
git push
```

## Полезные команды Git

```bash
# Просмотр веток
git branch -a

# Просмотр тегов
git tag

# Просмотр истории коммитов
git log --oneline --graph --all

# Отмена последнего коммита (не push)
git reset --soft HEAD~1

# Просмотр статуса
git status
```

## Структура веток

```
main (production)
  ├── development (разработка)
  │     └── feature/* (новые функции)
  └── release/* (подготовка релизов)
```

## Чеклист выполнения

- [ ] Репозиторий создан на GitHub
- [ ] CI workflow настроен и работает
- [ ] Тесты написаны и проходят
- [ ] Ветка development создана
- [ ] Новая функция разработана в development
- [ ] PR создан и успешно прошел тесты
- [ ] PR слит в main
- [ ] Ветка release создана
- [ ] Версия обновлена в release
- [ ] Тег версии создан
- [ ] Документация создана
- [ ] Автоматическая генерация документации работает
- [ ] Все workflow проходят успешно

